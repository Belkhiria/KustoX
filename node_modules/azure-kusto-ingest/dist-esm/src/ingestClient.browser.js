"use strict";
// Copyright (c) Microsoft Corporation.
// Licensed under the MIT License.
Object.defineProperty(exports, "__esModule", { value: true });
exports.KustoIngestClient = void 0;
const descriptors_1 = require("./descriptors");
const fileDescriptor_browser_1 = require("./fileDescriptor.browser");
const ingestClientBase_1 = require("./ingestClientBase");
class KustoIngestClient extends ingestClientBase_1.KustoIngestClientBase {
    constructor(kcsb, defaultProps) {
        super(kcsb, defaultProps, true);
    }
    /**
     * Use string for Node.js and Blob in browser
     */
    async ingestFromFile(file, ingestionProperties) {
        this.ensureOpen();
        const descriptor = file instanceof fileDescriptor_browser_1.FileDescriptor ? file : new fileDescriptor_browser_1.FileDescriptor(file);
        const blob = descriptor.file;
        const props = this._getMergedProps(ingestionProperties);
        const [fileToUpload, blockBlobClient] = await Promise.all([
            descriptor.prepare(),
            this.resourceManager.getBlockBlobClient((0, descriptors_1.generateBlobName)(descriptor, props)),
        ]);
        await blockBlobClient.uploadData(fileToUpload);
        return this.ingestFromBlob(new descriptors_1.BlobDescriptor(blockBlobClient.url, blob.size, descriptor.sourceId), props);
    }
    /**
     * Use Readable for Node.js and ArrayBuffer in browser
     */
    async ingestFromStream(stream, ingestionProperties) {
        this.ensureOpen();
        const props = this._getMergedProps(ingestionProperties);
        const descriptor = stream instanceof descriptors_1.StreamDescriptor ? stream : new descriptors_1.StreamDescriptor(stream);
        const blobName = (0, descriptors_1.generateBlobName)(descriptor, props);
        const blockBlobClient = await this.resourceManager.getBlockBlobClient(blobName);
        await blockBlobClient.uploadData(descriptor.stream);
        return this.ingestFromBlob(new descriptors_1.BlobDescriptor(blockBlobClient.url), props); // descriptor.size?
    }
}
exports.KustoIngestClient = KustoIngestClient;
exports.default = KustoIngestClient;
//# sourceMappingURL=ingestClient.browser.js.map